{"version":3,"file":"component---src-pages-notebook-database-transaction-and-lock-md-65af7984dfce6cc14680.js","mappings":"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","sources":["webpack://gatsby-starter-blog/./src/pages/notebook/database/transaction_and_lock.md","webpack://gatsby-starter-blog/./node_modules/@babel/runtime/helpers/esm/objectWithoutPropertiesLoose.js"],"sourcesContent":["import * as React from 'react'\n  /* @jsx mdx */\nimport { mdx } from '@mdx-js/react';\n/* @jsxRuntime classic */\n\n/* @jsx mdx */\n\nexport const _frontmatter = {\n  \"title\": \"事务和锁（包含Sequelize下的代码）\",\n  \"date\": \"2019-12-09T06:09:03.000Z\",\n  \"description\": \"事务和锁\",\n  \"type\": \"数据库\"\n};\nconst layoutProps = {\n  _frontmatter\n};\nconst MDXLayout = \"wrapper\";\nexport default function MDXContent({\n  components,\n  ...props\n}) {\n  return <MDXLayout {...layoutProps} {...props} components={components} mdxType=\"MDXLayout\">\n    <h5 {...{\n      \"id\": \"事务transaction\",\n      \"style\": {\n        \"position\": \"relative\"\n      }\n    }}><a parentName=\"h5\" {...{\n        \"href\": \"#%E4%BA%8B%E5%8A%A1transaction\",\n        \"aria-label\": \"事务transaction permalink\",\n        \"className\": \"anchor before\"\n      }}><svg parentName=\"a\" {...{\n          \"aria-hidden\": \"true\",\n          \"focusable\": \"false\",\n          \"height\": \"16\",\n          \"version\": \"1.1\",\n          \"viewBox\": \"0 0 16 16\",\n          \"width\": \"16\"\n        }}><path parentName=\"svg\" {...{\n            \"fillRule\": \"evenodd\",\n            \"d\": \"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"\n          }}></path></svg></a>{`事务(Transaction)：`}</h5>\n    <ul>\n      <li parentName=\"ul\">{`事务是数据库执行过程中的一个逻辑单位，由一系列有限的数据库操作序列构成。被事务裹起来的这些操作会有共同的执行结果，要么全部成功，要么失败并全部回滚。可以解决操作原子性的问题。`}</li>\n    </ul>\n    <p>{`如银行转账，A转账100给B，即需要：`}</p>\n    <div {...{\n      \"className\": \"gatsby-highlight\",\n      \"data-language\": \"sql\"\n    }}><pre parentName=\"div\" {...{\n        \"className\": \"language-sql\"\n      }}><code parentName=\"pre\" {...{\n          \"className\": \"language-sql\"\n        }}>{`A余额 `}<span parentName=\"code\" {...{\n            \"className\": \"token operator\"\n          }}>{`-`}</span><span parentName=\"code\" {...{\n            \"className\": \"token operator\"\n          }}>{`=`}</span>{` `}<span parentName=\"code\" {...{\n            \"className\": \"token number\"\n          }}>{`100`}</span>{`\nB余额 `}<span parentName=\"code\" {...{\n            \"className\": \"token operator\"\n          }}>{`+`}</span><span parentName=\"code\" {...{\n            \"className\": \"token operator\"\n          }}>{`=`}</span>{` `}<span parentName=\"code\" {...{\n            \"className\": \"token number\"\n          }}>{`100`}</span></code></pre></div>\n    <p>{`两条语句虽然独立，但最终结果必须是要么都执行，要么都不执行。`}</p>\n    <div {...{\n      \"className\": \"gatsby-highlight\",\n      \"data-language\": \"sql\"\n    }}><pre parentName=\"div\" {...{\n        \"className\": \"language-sql\"\n      }}><code parentName=\"pre\" {...{\n          \"className\": \"language-sql\"\n        }}><span parentName=\"code\" {...{\n            \"className\": \"token comment\"\n          }}>{`// SQL代码`}</span>{`\n`}<span parentName=\"code\" {...{\n            \"className\": \"token keyword\"\n          }}>{`start`}</span>{` `}<span parentName=\"code\" {...{\n            \"className\": \"token keyword\"\n          }}>{`transaction`}</span><span parentName=\"code\" {...{\n            \"className\": \"token punctuation\"\n          }}>{`;`}</span>{`\n`}<span parentName=\"code\" {...{\n            \"className\": \"token comment\"\n          }}>{`// 操作`}</span>{`\n`}<span parentName=\"code\" {...{\n            \"className\": \"token keyword\"\n          }}>{`commit`}</span><span parentName=\"code\" {...{\n            \"className\": \"token punctuation\"\n          }}>{`;`}</span></code></pre></div>\n    <p><code parentName=\"p\" {...{\n        \"className\": \"language-text\"\n      }}>{`Sequelize`}</code>{`提供`}<code parentName=\"p\" {...{\n        \"className\": \"language-text\"\n      }}>{`Transaction`}</code>{`类，通过`}<code parentName=\"p\" {...{\n        \"className\": \"language-text\"\n      }}>{`Sequelize.transaction`}</code>{`创建事务，并在每一次数据库操作设置当前操作属于哪个事务：`}</p>\n    <div {...{\n      \"className\": \"gatsby-highlight\",\n      \"data-language\": \"javascript\"\n    }}><pre parentName=\"div\" {...{\n        \"className\": \"language-javascript\"\n      }}><code parentName=\"pre\" {...{\n          \"className\": \"language-javascript\"\n        }}><span parentName=\"code\" {...{\n            \"className\": \"token keyword\"\n          }}>{`await`}</span>{` sequelize`}<span parentName=\"code\" {...{\n            \"className\": \"token punctuation\"\n          }}>{`.`}</span><span parentName=\"code\" {...{\n            \"className\": \"token function\"\n          }}>{`transaction`}</span><span parentName=\"code\" {...{\n            \"className\": \"token punctuation\"\n          }}>{`(`}</span><span parentName=\"code\" {...{\n            \"className\": \"token punctuation\"\n          }}>{`{`}</span><span parentName=\"code\" {...{\n            \"className\": \"token punctuation\"\n          }}>{`}`}</span><span parentName=\"code\" {...{\n            \"className\": \"token punctuation\"\n          }}>{`,`}</span>{` `}<span parentName=\"code\" {...{\n            \"className\": \"token keyword\"\n          }}>{`async`}</span>{` `}<span parentName=\"code\" {...{\n            \"className\": \"token punctuation\"\n          }}>{`(`}</span><span parentName=\"code\" {...{\n            \"className\": \"token parameter\"\n          }}>{`transaction`}</span><span parentName=\"code\" {...{\n            \"className\": \"token punctuation\"\n          }}>{`)`}</span>{` `}<span parentName=\"code\" {...{\n            \"className\": \"token operator\"\n          }}>{`=>`}</span>{` `}<span parentName=\"code\" {...{\n            \"className\": \"token punctuation\"\n          }}>{`{`}</span>{`\n  `}<span parentName=\"code\" {...{\n            \"className\": \"token keyword\"\n          }}>{`const`}</span>{` instance `}<span parentName=\"code\" {...{\n            \"className\": \"token operator\"\n          }}>{`=`}</span>{` `}<span parentName=\"code\" {...{\n            \"className\": \"token keyword\"\n          }}>{`await`}</span>{` Accounts`}<span parentName=\"code\" {...{\n            \"className\": \"token punctuation\"\n          }}>{`.`}</span><span parentName=\"code\" {...{\n            \"className\": \"token function\"\n          }}>{`findOne`}</span><span parentName=\"code\" {...{\n            \"className\": \"token punctuation\"\n          }}>{`(`}</span><span parentName=\"code\" {...{\n            \"className\": \"token punctuation\"\n          }}>{`{`}</span>{`\n    where`}<span parentName=\"code\" {...{\n            \"className\": \"token operator\"\n          }}>{`:`}</span>{` `}<span parentName=\"code\" {...{\n            \"className\": \"token punctuation\"\n          }}>{`{`}</span>{`\n      name`}<span parentName=\"code\" {...{\n            \"className\": \"token operator\"\n          }}>{`:`}</span>{` `}<span parentName=\"code\" {...{\n            \"className\": \"token string\"\n          }}>{`'name'`}</span><span parentName=\"code\" {...{\n            \"className\": \"token punctuation\"\n          }}>{`,`}</span>{`\n    `}<span parentName=\"code\" {...{\n            \"className\": \"token punctuation\"\n          }}>{`}`}</span><span parentName=\"code\" {...{\n            \"className\": \"token punctuation\"\n          }}>{`,`}</span>{`\n    transaction\n  `}<span parentName=\"code\" {...{\n            \"className\": \"token punctuation\"\n          }}>{`}`}</span><span parentName=\"code\" {...{\n            \"className\": \"token punctuation\"\n          }}>{`)`}</span><span parentName=\"code\" {...{\n            \"className\": \"token punctuation\"\n          }}>{`;`}</span>{`\n  \n  `}<span parentName=\"code\" {...{\n            \"className\": \"token keyword\"\n          }}>{`await`}</span>{` instance`}<span parentName=\"code\" {...{\n            \"className\": \"token punctuation\"\n          }}>{`.`}</span><span parentName=\"code\" {...{\n            \"className\": \"token function\"\n          }}>{`update`}</span><span parentName=\"code\" {...{\n            \"className\": \"token punctuation\"\n          }}>{`(`}</span><span parentName=\"code\" {...{\n            \"className\": \"token punctuation\"\n          }}>{`{`}</span>{`\n    balances`}<span parentName=\"code\" {...{\n            \"className\": \"token operator\"\n          }}>{`:`}</span>{` instance`}<span parentName=\"code\" {...{\n            \"className\": \"token punctuation\"\n          }}>{`.`}</span>{`balances `}<span parentName=\"code\" {...{\n            \"className\": \"token operator\"\n          }}>{`+`}</span>{` number`}<span parentName=\"code\" {...{\n            \"className\": \"token punctuation\"\n          }}>{`,`}</span>{`\n  `}<span parentName=\"code\" {...{\n            \"className\": \"token punctuation\"\n          }}>{`}`}</span><span parentName=\"code\" {...{\n            \"className\": \"token punctuation\"\n          }}>{`,`}</span>{` `}<span parentName=\"code\" {...{\n            \"className\": \"token punctuation\"\n          }}>{`{`}</span>{`\n    transaction\n  `}<span parentName=\"code\" {...{\n            \"className\": \"token punctuation\"\n          }}>{`}`}</span><span parentName=\"code\" {...{\n            \"className\": \"token punctuation\"\n          }}>{`)`}</span>{`\n`}<span parentName=\"code\" {...{\n            \"className\": \"token punctuation\"\n          }}>{`}`}</span><span parentName=\"code\" {...{\n            \"className\": \"token punctuation\"\n          }}>{`)`}</span>{`\n`}</code></pre></div>\n    <hr></hr>\n    <h5 {...{\n      \"id\": \"并发\",\n      \"style\": {\n        \"position\": \"relative\"\n      }\n    }}><a parentName=\"h5\" {...{\n        \"href\": \"#%E5%B9%B6%E5%8F%91\",\n        \"aria-label\": \"并发 permalink\",\n        \"className\": \"anchor before\"\n      }}><svg parentName=\"a\" {...{\n          \"aria-hidden\": \"true\",\n          \"focusable\": \"false\",\n          \"height\": \"16\",\n          \"version\": \"1.1\",\n          \"viewBox\": \"0 0 16 16\",\n          \"width\": \"16\"\n        }}><path parentName=\"svg\" {...{\n            \"fillRule\": \"evenodd\",\n            \"d\": \"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"\n          }}></path></svg></a>{`并发`}</h5>\n    <p>{`事务只解决了操作原子性的问题，并发则需要通过加锁来避免。`}</p>\n    <h6 {...{\n      \"id\": \"锁\",\n      \"style\": {\n        \"position\": \"relative\"\n      }\n    }}><a parentName=\"h6\" {...{\n        \"href\": \"#%E9%94%81\",\n        \"aria-label\": \"锁 permalink\",\n        \"className\": \"anchor before\"\n      }}><svg parentName=\"a\" {...{\n          \"aria-hidden\": \"true\",\n          \"focusable\": \"false\",\n          \"height\": \"16\",\n          \"version\": \"1.1\",\n          \"viewBox\": \"0 0 16 16\",\n          \"width\": \"16\"\n        }}><path parentName=\"svg\" {...{\n            \"fillRule\": \"evenodd\",\n            \"d\": \"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"\n          }}></path></svg></a>{`锁：`}</h6>\n    <ul>\n      <li parentName=\"ul\">\n        <p parentName=\"li\"><code parentName=\"p\" {...{\n            \"className\": \"language-text\"\n          }}>{`悲观锁`}</code>{`：为了避免冲突，直接给记录加上锁，再事务释放之前，其他要对该记录执行操作的事务都必须等待。MySql、Postgres都实现了悲观锁。缺点是，再读操作频繁的场景下，会影响吞吐量。`}</p>\n      </li>\n      <li parentName=\"ul\">\n        <p parentName=\"li\"><code parentName=\"p\" {...{\n            \"className\": \"language-text\"\n          }}>{`乐观锁`}</code>{`：不对读进行限制，仅在写入更新的时候做判断。通常会增加version字段，每次更新的时候version+1，提交更新的时候先判断version，如果已失效则重试。在写操作频繁的场景下会不断发生重试，也会影响吞吐量。`}</p>\n      </li>\n      <li parentName=\"ul\">\n        <p parentName=\"li\"><code parentName=\"p\" {...{\n            \"className\": \"language-text\"\n          }}>{`排他锁`}</code>{`：悲观锁的一种，查询的时候加锁。同一资源同一时间只能有一个排他锁，其他事务读写都需要等待。`}</p>\n      </li>\n    </ul>\n    <div {...{\n      \"className\": \"gatsby-highlight\",\n      \"data-language\": \"sql\"\n    }}><pre parentName=\"div\" {...{\n        \"className\": \"language-sql\"\n      }}><code parentName=\"pre\" {...{\n          \"className\": \"language-sql\"\n        }}><span parentName=\"code\" {...{\n            \"className\": \"token comment\"\n          }}>{`// SQL代码`}</span>{`\n`}<span parentName=\"code\" {...{\n            \"className\": \"token keyword\"\n          }}>{`SELECT`}</span>{` `}<span parentName=\"code\" {...{\n            \"className\": \"token operator\"\n          }}>{`*`}</span>{` `}<span parentName=\"code\" {...{\n            \"className\": \"token keyword\"\n          }}>{`FROM`}</span>{` accounts `}<span parentName=\"code\" {...{\n            \"className\": \"token keyword\"\n          }}>{`WHERE`}</span>{` name`}<span parentName=\"code\" {...{\n            \"className\": \"token operator\"\n          }}>{`=`}</span><span parentName=\"code\" {...{\n            \"className\": \"token string\"\n          }}>{`'name'`}</span>{` `}<span parentName=\"code\" {...{\n            \"className\": \"token keyword\"\n          }}>{`FOR`}</span>{` `}<span parentName=\"code\" {...{\n            \"className\": \"token keyword\"\n          }}>{`UPDATE`}</span><span parentName=\"code\" {...{\n            \"className\": \"token punctuation\"\n          }}>{`;`}</span></code></pre></div>\n    <div {...{\n      \"className\": \"gatsby-highlight\",\n      \"data-language\": \"javascript\"\n    }}><pre parentName=\"div\" {...{\n        \"className\": \"language-javascript\"\n      }}><code parentName=\"pre\" {...{\n          \"className\": \"language-javascript\"\n        }}><span parentName=\"code\" {...{\n            \"className\": \"token comment\"\n          }}>{`// Sequelize 写法`}</span>{`\n`}<span parentName=\"code\" {...{\n            \"className\": \"token keyword\"\n          }}>{`await`}</span>{` Accounts`}<span parentName=\"code\" {...{\n            \"className\": \"token punctuation\"\n          }}>{`.`}</span><span parentName=\"code\" {...{\n            \"className\": \"token function\"\n          }}>{`findOne`}</span><span parentName=\"code\" {...{\n            \"className\": \"token punctuation\"\n          }}>{`(`}</span><span parentName=\"code\" {...{\n            \"className\": \"token punctuation\"\n          }}>{`{`}</span>{`\n  where`}<span parentName=\"code\" {...{\n            \"className\": \"token operator\"\n          }}>{`:`}</span>{` `}<span parentName=\"code\" {...{\n            \"className\": \"token punctuation\"\n          }}>{`{`}</span>{` name`}<span parentName=\"code\" {...{\n            \"className\": \"token operator\"\n          }}>{`:`}</span>{` `}<span parentName=\"code\" {...{\n            \"className\": \"token string\"\n          }}>{`'name'`}</span>{` `}<span parentName=\"code\" {...{\n            \"className\": \"token punctuation\"\n          }}>{`}`}</span><span parentName=\"code\" {...{\n            \"className\": \"token punctuation\"\n          }}>{`,`}</span>{`\n  lock`}<span parentName=\"code\" {...{\n            \"className\": \"token operator\"\n          }}>{`:`}</span>{` Sequelize`}<span parentName=\"code\" {...{\n            \"className\": \"token punctuation\"\n          }}>{`.`}</span>{`Transaction`}<span parentName=\"code\" {...{\n            \"className\": \"token punctuation\"\n          }}>{`.`}</span><span parentName=\"code\" {...{\n            \"className\": \"token constant\"\n          }}>{`LOCK`}</span><span parentName=\"code\" {...{\n            \"className\": \"token punctuation\"\n          }}>{`.`}</span><span parentName=\"code\" {...{\n            \"className\": \"token constant\"\n          }}>{`UPDATE`}</span>{`\n`}<span parentName=\"code\" {...{\n            \"className\": \"token punctuation\"\n          }}>{`}`}</span><span parentName=\"code\" {...{\n            \"className\": \"token punctuation\"\n          }}>{`)`}</span><span parentName=\"code\" {...{\n            \"className\": \"token punctuation\"\n          }}>{`;`}</span></code></pre></div>\n    <ul>\n      <li parentName=\"ul\"><code parentName=\"li\" {...{\n          \"className\": \"language-text\"\n        }}>{`共享锁`}</code>{`：允许同一资源同时存在多个共享锁，当需要执行修改、删除等操作时，必须等其他所有共享锁都释放后才能执行。`}</li>\n    </ul>\n    <div {...{\n      \"className\": \"gatsby-highlight\",\n      \"data-language\": \"sql\"\n    }}><pre parentName=\"div\" {...{\n        \"className\": \"language-sql\"\n      }}><code parentName=\"pre\" {...{\n          \"className\": \"language-sql\"\n        }}><span parentName=\"code\" {...{\n            \"className\": \"token keyword\"\n          }}>{`SELECT`}</span>{` `}<span parentName=\"code\" {...{\n            \"className\": \"token operator\"\n          }}>{`*`}</span>{` `}<span parentName=\"code\" {...{\n            \"className\": \"token keyword\"\n          }}>{`FROM`}</span>{` accounts `}<span parentName=\"code\" {...{\n            \"className\": \"token keyword\"\n          }}>{`WHERE`}</span>{` name`}<span parentName=\"code\" {...{\n            \"className\": \"token operator\"\n          }}>{`=`}</span><span parentName=\"code\" {...{\n            \"className\": \"token string\"\n          }}>{`'name'`}</span>{` `}<span parentName=\"code\" {...{\n            \"className\": \"token keyword\"\n          }}>{`FOR`}</span>{` `}<span parentName=\"code\" {...{\n            \"className\": \"token keyword\"\n          }}>{`SHARE`}</span><span parentName=\"code\" {...{\n            \"className\": \"token punctuation\"\n          }}>{`;`}</span></code></pre></div>\n    <div {...{\n      \"className\": \"gatsby-highlight\",\n      \"data-language\": \"javascript\"\n    }}><pre parentName=\"div\" {...{\n        \"className\": \"language-javascript\"\n      }}><code parentName=\"pre\" {...{\n          \"className\": \"language-javascript\"\n        }}><span parentName=\"code\" {...{\n            \"className\": \"token keyword\"\n          }}>{`await`}</span>{` Accounts`}<span parentName=\"code\" {...{\n            \"className\": \"token punctuation\"\n          }}>{`.`}</span><span parentName=\"code\" {...{\n            \"className\": \"token function\"\n          }}>{`findOne`}</span><span parentName=\"code\" {...{\n            \"className\": \"token punctuation\"\n          }}>{`(`}</span><span parentName=\"code\" {...{\n            \"className\": \"token punctuation\"\n          }}>{`{`}</span>{`\n  where`}<span parentName=\"code\" {...{\n            \"className\": \"token operator\"\n          }}>{`:`}</span>{` `}<span parentName=\"code\" {...{\n            \"className\": \"token punctuation\"\n          }}>{`{`}</span>{`name`}<span parentName=\"code\" {...{\n            \"className\": \"token operator\"\n          }}>{`:`}</span><span parentName=\"code\" {...{\n            \"className\": \"token string\"\n          }}>{`'name'`}</span>{` `}<span parentName=\"code\" {...{\n            \"className\": \"token punctuation\"\n          }}>{`}`}</span><span parentName=\"code\" {...{\n            \"className\": \"token punctuation\"\n          }}>{`,`}</span>{`\n  lock`}<span parentName=\"code\" {...{\n            \"className\": \"token operator\"\n          }}>{`:`}</span>{` Sequelize`}<span parentName=\"code\" {...{\n            \"className\": \"token punctuation\"\n          }}>{`.`}</span>{`Transaction`}<span parentName=\"code\" {...{\n            \"className\": \"token punctuation\"\n          }}>{`.`}</span><span parentName=\"code\" {...{\n            \"className\": \"token constant\"\n          }}>{`LOCK`}</span><span parentName=\"code\" {...{\n            \"className\": \"token punctuation\"\n          }}>{`.`}</span><span parentName=\"code\" {...{\n            \"className\": \"token constant\"\n          }}>{`SHARE`}</span>{`\n`}<span parentName=\"code\" {...{\n            \"className\": \"token punctuation\"\n          }}>{`}`}</span><span parentName=\"code\" {...{\n            \"className\": \"token punctuation\"\n          }}>{`)`}</span></code></pre></div>\n    <h4 {...{\n      \"id\": \"事务隔离级\",\n      \"style\": {\n        \"position\": \"relative\"\n      }\n    }}><a parentName=\"h4\" {...{\n        \"href\": \"#%E4%BA%8B%E5%8A%A1%E9%9A%94%E7%A6%BB%E7%BA%A7\",\n        \"aria-label\": \"事务隔离级 permalink\",\n        \"className\": \"anchor before\"\n      }}><svg parentName=\"a\" {...{\n          \"aria-hidden\": \"true\",\n          \"focusable\": \"false\",\n          \"height\": \"16\",\n          \"version\": \"1.1\",\n          \"viewBox\": \"0 0 16 16\",\n          \"width\": \"16\"\n        }}><path parentName=\"svg\" {...{\n            \"fillRule\": \"evenodd\",\n            \"d\": \"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"\n          }}></path></svg></a>{`事务隔离级`}</h4>\n    <table className=\"table table-bordered table-striped table-dark\">\n  <thead>\n    <tr>\n      <th scope=\"col\">级别</th>\n      <th scope=\"col\">脏读</th>\n      <th scope=\"col\">不可重复读</th>\n      <th scope=\"col\">幻读</th>\n    </tr>\n  </thead>\n  <tbody>\n    <tr>\n      <th scope=\"row\">READ_UNCOMMITTED 读未提交</th>\n      <td></td>\n      <td></td>\n      <td></td>\n    </tr>\n    <tr>\n      <th scope=\"row\">READ_COMMITTED 读已提交</th>\n      <td>×</td>\n      <td></td>\n      <td></td>\n    </tr>\n    <tr>\n      <th scope=\"row\">REPEATABLE_READ 可重复读</th>\n      <td>×</td>\n      <td>×</td>\n      <td></td>\n    </tr>\n        <tr>\n      <th scope=\"row\">SERIALIZABLE 可串行化</th>\n      <td>×</td>\n      <td>×</td>\n      <td>×</td>\n    </tr>\n  </tbody>\n    </table>\n    <ul>\n      <li parentName=\"ul\">{`×表示在这个级别里，某类问题不会出现。`}</li>\n    </ul>\n    <h6 {...{\n      \"id\": \"相关文章\",\n      \"style\": {\n        \"position\": \"relative\"\n      }\n    }}><a parentName=\"h6\" {...{\n        \"href\": \"#%E7%9B%B8%E5%85%B3%E6%96%87%E7%AB%A0\",\n        \"aria-label\": \"相关文章 permalink\",\n        \"className\": \"anchor before\"\n      }}><svg parentName=\"a\" {...{\n          \"aria-hidden\": \"true\",\n          \"focusable\": \"false\",\n          \"height\": \"16\",\n          \"version\": \"1.1\",\n          \"viewBox\": \"0 0 16 16\",\n          \"width\": \"16\"\n        }}><path parentName=\"svg\" {...{\n            \"fillRule\": \"evenodd\",\n            \"d\": \"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"\n          }}></path></svg></a>{`相关文章`}</h6>\n    <ul>\n      <li parentName=\"ul\"><a parentName=\"li\" {...{\n          \"href\": \"https://juejin.im/post/5c98e31f51882574c6520dc3\"\n        }}>{`学点后端知识之 Sequelize 中创建事务和🔐`}</a></li>\n    </ul>\n\n    </MDXLayout>;\n}\n;\nMDXContent.isMDXComponent = true;\n      ","export default function _objectWithoutPropertiesLoose(source, excluded) {\n  if (source == null) return {};\n  var target = {};\n  var sourceKeys = Object.keys(source);\n  var key, i;\n\n  for (i = 0; i < sourceKeys.length; i++) {\n    key = sourceKeys[i];\n    if (excluded.indexOf(key) >= 0) continue;\n    target[key] = source[key];\n  }\n\n  return target;\n}"],"names":["_frontmatter","layoutProps","MDXContent","components","props","mdxType","parentName","className","scope","isMDXComponent","_objectWithoutPropertiesLoose","source","excluded","key","i","target","sourceKeys","Object","keys","length","indexOf"],"sourceRoot":""}