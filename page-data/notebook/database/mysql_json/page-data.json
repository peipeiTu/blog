{"componentChunkName":"component---src-templates-blog-post-js","path":"/notebook/database/mysql_json/","result":{"data":{"markdownRemark":{"html":"<blockquote>\n<blockquote>\n<p>之前一直不知道mysql已经支持了json类型，还一直傻兮兮的用text去存储。从MySQL5.7.8开始，MySql已经支持原生JSON数据类型。</p>\n</blockquote>\n</blockquote>\n<h4 id=\"创建\"><a href=\"#%E5%88%9B%E5%BB%BA\" aria-label=\"创建 permalink\" class=\"anchor\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>创建</h4>\n<p><code class=\"language-text\">JSON</code>字段不能设置长度，可以是NULL，但不能有默认值</p>\n<div class=\"gatsby-highlight\" data-language=\"sql\"><pre class=\"language-sql\"><code class=\"language-sql\"><span class=\"token keyword\">CREATE</span> <span class=\"token keyword\">TABLE</span> student <span class=\"token punctuation\">(</span>\n  <span class=\"token punctuation\">`</span>id<span class=\"token punctuation\">`</span> <span class=\"token keyword\">int</span><span class=\"token punctuation\">(</span><span class=\"token number\">10</span><span class=\"token punctuation\">)</span> <span class=\"token keyword\">unsigned</span> <span class=\"token operator\">NOT</span> <span class=\"token boolean\">NULL</span> <span class=\"token keyword\">AUTO_INCREMENT</span><span class=\"token punctuation\">,</span>\n  <span class=\"token punctuation\">`</span>info<span class=\"token punctuation\">`</span> JSON<span class=\"token punctuation\">,</span>\n  <span class=\"token punctuation\">`</span>record<span class=\"token punctuation\">`</span> JSON<span class=\"token punctuation\">,</span>\n  <span class=\"token keyword\">PRIMARY</span> <span class=\"token keyword\">KEY</span> <span class=\"token punctuation\">(</span><span class=\"token punctuation\">`</span>id<span class=\"token punctuation\">`</span><span class=\"token punctuation\">)</span>\n<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></code></pre></div>\n<h4 id=\"插入\"><a href=\"#%E6%8F%92%E5%85%A5\" aria-label=\"插入 permalink\" class=\"anchor\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>插入</h4>\n<p>插入JSON格式的字符串，可以是对象形式，也可以是数组形式。插入会检查格式是否正确，如果不正确会插入失败。</p>\n<div class=\"gatsby-highlight\" data-language=\"sql\"><pre class=\"language-sql\"><code class=\"language-sql\"><span class=\"token keyword\">INSERT</span> <span class=\"token keyword\">INTO</span> <span class=\"token punctuation\">`</span>student<span class=\"token punctuation\">`</span> <span class=\"token punctuation\">(</span>info<span class=\"token punctuation\">,</span> record<span class=\"token punctuation\">)</span> <span class=\"token keyword\">VALUES</span> <span class=\"token punctuation\">(</span><span class=\"token string\">'{\"id\": 1, \"name\": \"xiaoming\"}'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'[1, 2, 3]'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></code></pre></div>\n<p><code class=\"language-text\">MySQL</code>提供函数<code class=\"language-text\">JSON_OBJECT</code>,<code class=\"language-text\">JSON_ARRAY</code>来生成符合格式的数据。</p>\n<div class=\"gatsby-highlight\" data-language=\"sql\"><pre class=\"language-sql\"><code class=\"language-sql\"><span class=\"token keyword\">INSERT</span> <span class=\"token keyword\">INTO</span> <span class=\"token punctuation\">`</span>student<span class=\"token punctuation\">`</span> <span class=\"token punctuation\">(</span>info<span class=\"token punctuation\">,</span> record<span class=\"token punctuation\">)</span>  <span class=\"token keyword\">VALUES</span> <span class=\"token punctuation\">(</span>JSON_OBJECT<span class=\"token punctuation\">(</span><span class=\"token string\">\"id\"</span><span class=\"token punctuation\">,</span> <span class=\"token number\">2</span><span class=\"token punctuation\">,</span> <span class=\"token string\">\"name\"</span><span class=\"token punctuation\">,</span> <span class=\"token string\">\"xiaohong\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span> JSON_ARRAY<span class=\"token punctuation\">(</span><span class=\"token number\">1</span><span class=\"token punctuation\">,</span> <span class=\"token number\">3</span><span class=\"token punctuation\">,</span> <span class=\"token number\">5</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></code></pre></div>\n<p><a href=\"http://dev.mysql.com/doc/refman/5.7/en/json-creation-functions.html\">更多函数参考</a></p>\n<h4 id=\"查询\"><a href=\"#%E6%9F%A5%E8%AF%A2\" aria-label=\"查询 permalink\" class=\"anchor\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>查询</h4>\n<h5 id=\"查询字段\"><a href=\"#%E6%9F%A5%E8%AF%A2%E5%AD%97%E6%AE%B5\" aria-label=\"查询字段 permalink\" class=\"anchor\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>查询字段</h5>\n<p>查询<code class=\"language-text\">JSON</code>中的数据用<code class=\"language-text\">column-&gt;path</code>的形式。对象类型为<code class=\"language-text\">$.path</code>，数组类型为<code class=\"language-text\">$[index]</code></p>\n<div class=\"gatsby-highlight\" data-language=\"sql\"><pre class=\"language-sql\"><code class=\"language-sql\">mysql<span class=\"token operator\">></span> <span class=\"token keyword\">SELECT</span> id<span class=\"token punctuation\">,</span> info<span class=\"token operator\">-</span><span class=\"token operator\">></span><span class=\"token string\">'$.id'</span><span class=\"token punctuation\">,</span> info<span class=\"token operator\">-</span><span class=\"token operator\">></span><span class=\"token string\">'$.name'</span><span class=\"token punctuation\">,</span> record<span class=\"token operator\">-</span><span class=\"token operator\">></span><span class=\"token string\">'$[0]'</span><span class=\"token punctuation\">,</span> record<span class=\"token operator\">-</span><span class=\"token operator\">></span><span class=\"token string\">'$[2]'</span> <span class=\"token keyword\">FROM</span> student<span class=\"token punctuation\">;</span>\n<span class=\"token operator\">+</span><span class=\"token comment\">----+--------------+----------------+----------------+----------------+</span>\n<span class=\"token operator\">|</span> id <span class=\"token operator\">|</span> info<span class=\"token operator\">-</span><span class=\"token operator\">></span><span class=\"token string\">'$.id'</span> <span class=\"token operator\">|</span> info<span class=\"token operator\">-</span><span class=\"token operator\">></span><span class=\"token string\">'$.name'</span> <span class=\"token operator\">|</span> record<span class=\"token operator\">-</span><span class=\"token operator\">></span><span class=\"token string\">'$[0]'</span> <span class=\"token operator\">|</span> record<span class=\"token operator\">-</span><span class=\"token operator\">></span><span class=\"token string\">'$[2]'</span> <span class=\"token operator\">|</span>\n<span class=\"token operator\">+</span><span class=\"token comment\">----+--------------+----------------+----------------+----------------+</span>\n<span class=\"token operator\">|</span>  <span class=\"token number\">1</span> <span class=\"token operator\">|</span> <span class=\"token number\">1</span>            <span class=\"token operator\">|</span> <span class=\"token string\">\"xiaoming\"</span>     <span class=\"token operator\">|</span> <span class=\"token number\">1</span>              <span class=\"token operator\">|</span> <span class=\"token number\">3</span>              <span class=\"token operator\">|</span>\n<span class=\"token operator\">|</span>  <span class=\"token number\">2</span> <span class=\"token operator\">|</span> <span class=\"token number\">2</span>            <span class=\"token operator\">|</span> <span class=\"token string\">\"xiaohong\"</span>     <span class=\"token operator\">|</span> <span class=\"token number\">1</span>              <span class=\"token operator\">|</span> <span class=\"token number\">5</span>              <span class=\"token operator\">|</span>\n<span class=\"token operator\">+</span><span class=\"token comment\">----+--------------+----------------+----------------+----------------+</span>\n<span class=\"token number\">2</span> <span class=\"token keyword\">rows</span> <span class=\"token operator\">in</span> <span class=\"token keyword\">set</span> <span class=\"token punctuation\">(</span><span class=\"token number\">0.00</span> sec<span class=\"token punctuation\">)</span></code></pre></div>\n<p>这样查询的结果会带有双引号，使用函数<code class=\"language-text\">JSON_UNQUOTE</code>或操作符<code class=\"language-text\">-&gt;&gt;</code>可以去掉。</p>\n<div class=\"gatsby-highlight\" data-language=\"sql\"><pre class=\"language-sql\"><code class=\"language-sql\">mysql<span class=\"token operator\">></span> <span class=\"token keyword\">SELECT</span> id<span class=\"token punctuation\">,</span> info<span class=\"token operator\">-</span><span class=\"token operator\">></span><span class=\"token string\">'$.name'</span><span class=\"token punctuation\">,</span> JSON_UNQUOTE<span class=\"token punctuation\">(</span>info<span class=\"token operator\">-</span><span class=\"token operator\">></span><span class=\"token string\">'$.name'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span> info<span class=\"token operator\">-</span><span class=\"token operator\">>></span><span class=\"token string\">'$.name'</span> <span class=\"token keyword\">FROM</span> student<span class=\"token punctuation\">;</span>\n<span class=\"token operator\">+</span><span class=\"token comment\">----+----------------+------------------------------+-----------------+</span>\n<span class=\"token operator\">|</span> id <span class=\"token operator\">|</span> info<span class=\"token operator\">-</span><span class=\"token operator\">></span><span class=\"token string\">'$.name'</span> <span class=\"token operator\">|</span> JSON_UNQUOTE<span class=\"token punctuation\">(</span>info<span class=\"token operator\">-</span><span class=\"token operator\">></span><span class=\"token string\">'$.name'</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">|</span> info<span class=\"token operator\">-</span><span class=\"token operator\">>></span><span class=\"token string\">'$.name'</span> <span class=\"token operator\">|</span>\n<span class=\"token operator\">+</span><span class=\"token comment\">----+----------------+------------------------------+-----------------+</span>\n<span class=\"token operator\">|</span>  <span class=\"token number\">1</span> <span class=\"token operator\">|</span> <span class=\"token string\">\"xiaoming\"</span>     <span class=\"token operator\">|</span> xiaoming                     <span class=\"token operator\">|</span> xiaoming        <span class=\"token operator\">|</span>\n<span class=\"token operator\">|</span>  <span class=\"token number\">2</span> <span class=\"token operator\">|</span> <span class=\"token string\">\"xiaohong\"</span>     <span class=\"token operator\">|</span> xiaoming                     <span class=\"token operator\">|</span> xiaoming        <span class=\"token operator\">|</span>\n<span class=\"token operator\">+</span><span class=\"token comment\">----+----------------+------------------------------+-----------------+</span>\n<span class=\"token number\">2</span> <span class=\"token keyword\">rows</span> <span class=\"token operator\">in</span> <span class=\"token keyword\">set</span> <span class=\"token punctuation\">(</span><span class=\"token number\">0.00</span> sec<span class=\"token punctuation\">)</span></code></pre></div>\n<h5 id=\"条件搜索\"><a href=\"#%E6%9D%A1%E4%BB%B6%E6%90%9C%E7%B4%A2\" aria-label=\"条件搜索 permalink\" class=\"anchor\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>条件搜索</h5>\n<p>以<code class=\"language-text\">JSON</code>作为条件搜索的时候，不能直接和字符串比较，是无法匹配到的，可以通过<code class=\"language-text\">CAST</code>将字符串转成<code class=\"language-text\">JSON</code>的形式。</p>\n<div class=\"gatsby-highlight\" data-language=\"sql\"><pre class=\"language-sql\"><code class=\"language-sql\"><span class=\"token keyword\">SELECT</span> <span class=\"token operator\">*</span> <span class=\"token keyword\">FROM</span> student <span class=\"token keyword\">WHERE</span> info <span class=\"token operator\">=</span> CAST<span class=\"token punctuation\">(</span><span class=\"token string\">'{\"id\": 1, \"name\": \"xiaoming\"}'</span> <span class=\"token keyword\">as</span> JSON<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></code></pre></div>\n<p>通过<code class=\"language-text\">JSON</code>中的元素进行查询，同样使用<code class=\"language-text\">column-&gt;path</code>形式。</p>\n<div class=\"gatsby-highlight\" data-language=\"sql\"><pre class=\"language-sql\"><code class=\"language-sql\"><span class=\"token keyword\">SELECT</span> <span class=\"token operator\">*</span> <span class=\"token keyword\">FROM</span> student <span class=\"token keyword\">WHERE</span> info<span class=\"token operator\">-</span><span class=\"token operator\">></span><span class=\"token string\">'$.name'</span> <span class=\"token operator\">=</span> <span class=\"token string\">'xiaoming'</span><span class=\"token punctuation\">;</span></code></pre></div>\n<p><strong>值得注意的是，JSON中的元素搜索是严格区分数据类型的，整型和字符串不能相匹配</strong></p>\n<h4 id=\"更新\"><a href=\"#%E6%9B%B4%E6%96%B0\" aria-label=\"更新 permalink\" class=\"anchor\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>更新</h4>\n<p>整个<code class=\"language-text\">JSON</code>更新，和插入时类似。更新<code class=\"language-text\">JSON</code>下的元素，需要使用下列函数。</p>\n<h5 id=\"1-json_insert-插入新值，但不会覆盖已存在的值。\"><a href=\"#1-json_insert-%E6%8F%92%E5%85%A5%E6%96%B0%E5%80%BC%EF%BC%8C%E4%BD%86%E4%B8%8D%E4%BC%9A%E8%A6%86%E7%9B%96%E5%B7%B2%E5%AD%98%E5%9C%A8%E7%9A%84%E5%80%BC%E3%80%82\" aria-label=\"1 json_insert 插入新值，但不会覆盖已存在的值。 permalink\" class=\"anchor\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>1. <code class=\"language-text\">JSON_INSERT()</code> 插入新值，但不会覆盖已存在的值。</h5>\n<div class=\"gatsby-highlight\" data-language=\"sql\"><pre class=\"language-sql\"><code class=\"language-sql\">mysql<span class=\"token operator\">></span> <span class=\"token keyword\">UPDATE</span> student <span class=\"token keyword\">SET</span> category <span class=\"token operator\">=</span> JSON_INSERT<span class=\"token punctuation\">(</span>info<span class=\"token punctuation\">,</span> <span class=\"token string\">'$.name'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'xiaohua'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'$.class'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'one'</span><span class=\"token punctuation\">)</span> <span class=\"token keyword\">WHERE</span> id <span class=\"token operator\">=</span> <span class=\"token number\">1</span><span class=\"token punctuation\">;</span>\nQuery OK<span class=\"token punctuation\">,</span> <span class=\"token number\">1</span> <span class=\"token keyword\">row</span> affected <span class=\"token punctuation\">(</span><span class=\"token number\">0.00</span> sec<span class=\"token punctuation\">)</span>\n\n<span class=\"token operator\">+</span><span class=\"token comment\">----+------------------------------------------------+-----------+</span>\n<span class=\"token operator\">|</span> id <span class=\"token operator\">|</span> info                                           <span class=\"token operator\">|</span> record    <span class=\"token operator\">|</span>\n<span class=\"token operator\">+</span><span class=\"token comment\">----+------------------------------------------------+-----------+</span>\n<span class=\"token operator\">|</span>  <span class=\"token number\">1</span> <span class=\"token operator\">|</span> {<span class=\"token string\">\"id\"</span>: <span class=\"token number\">1</span><span class=\"token punctuation\">,</span> <span class=\"token string\">\"class\"</span>: <span class=\"token string\">\"one\"</span><span class=\"token punctuation\">,</span> <span class=\"token string\">\"name\"</span>: <span class=\"token string\">\"xiaoming\"</span>}  <span class=\"token operator\">|</span> <span class=\"token punctuation\">[</span><span class=\"token number\">1</span><span class=\"token punctuation\">,</span> <span class=\"token number\">3</span><span class=\"token punctuation\">,</span> <span class=\"token number\">4</span><span class=\"token punctuation\">]</span> <span class=\"token operator\">|</span>\n<span class=\"token operator\">|</span>  <span class=\"token number\">2</span> <span class=\"token operator\">|</span> {<span class=\"token string\">\"id\"</span>: <span class=\"token number\">2</span><span class=\"token punctuation\">,</span> <span class=\"token string\">\"name\"</span>: <span class=\"token string\">\"xiaohong\"</span>}                  <span class=\"token operator\">|</span> <span class=\"token punctuation\">[</span><span class=\"token number\">1</span><span class=\"token punctuation\">,</span> <span class=\"token number\">3</span><span class=\"token punctuation\">,</span> <span class=\"token number\">5</span><span class=\"token punctuation\">]</span> <span class=\"token operator\">|</span>\n<span class=\"token operator\">+</span><span class=\"token comment\">----+------------------------------------------------+-----------+</span></code></pre></div>\n<h5 id=\"2-json_set-插入新值，并覆盖已存在的值。\"><a href=\"#2-json_set-%E6%8F%92%E5%85%A5%E6%96%B0%E5%80%BC%EF%BC%8C%E5%B9%B6%E8%A6%86%E7%9B%96%E5%B7%B2%E5%AD%98%E5%9C%A8%E7%9A%84%E5%80%BC%E3%80%82\" aria-label=\"2 json_set 插入新值，并覆盖已存在的值。 permalink\" class=\"anchor\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>2. <code class=\"language-text\">JSON_SET()</code> 插入新值，并覆盖已存在的值。</h5>\n<div class=\"gatsby-highlight\" data-language=\"sql\"><pre class=\"language-sql\"><code class=\"language-sql\"><span class=\"token keyword\">UPDATE</span> student <span class=\"token keyword\">SET</span> info <span class=\"token operator\">=</span> JSON_SET<span class=\"token punctuation\">(</span>info<span class=\"token punctuation\">,</span> <span class=\"token string\">'$.age'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'1'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'$.class'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'two'</span><span class=\"token punctuation\">)</span> <span class=\"token keyword\">WHERE</span> id <span class=\"token operator\">=</span> <span class=\"token number\">1</span><span class=\"token punctuation\">;</span>\n\n<span class=\"token operator\">+</span><span class=\"token comment\">----+-----------------------------------------------------------+-----------+</span>\n<span class=\"token operator\">|</span> id <span class=\"token operator\">|</span> info                                                      <span class=\"token operator\">|</span> record    <span class=\"token operator\">|</span>\n<span class=\"token operator\">+</span><span class=\"token comment\">----+-----------------------------------------------------------+-----------+</span>\n<span class=\"token operator\">|</span>  <span class=\"token number\">1</span> <span class=\"token operator\">|</span> {<span class=\"token string\">\"id\"</span>: <span class=\"token number\">1</span><span class=\"token punctuation\">,</span> <span class=\"token string\">\"class\"</span>: <span class=\"token string\">\"two\"</span><span class=\"token punctuation\">,</span> <span class=\"token string\">\"age\"</span>: <span class=\"token string\">\"1\"</span><span class=\"token punctuation\">,</span> <span class=\"token string\">\"name\"</span>: <span class=\"token string\">\"xiaoming\"</span>} <span class=\"token operator\">|</span> <span class=\"token punctuation\">[</span><span class=\"token number\">1</span><span class=\"token punctuation\">,</span> <span class=\"token number\">3</span><span class=\"token punctuation\">,</span> <span class=\"token number\">4</span><span class=\"token punctuation\">]</span> <span class=\"token operator\">|</span>\n<span class=\"token operator\">|</span>  <span class=\"token number\">2</span> <span class=\"token operator\">|</span> {<span class=\"token string\">\"id\"</span>: <span class=\"token number\">2</span><span class=\"token punctuation\">,</span> <span class=\"token string\">\"name\"</span>: <span class=\"token string\">\"xiaohong\"</span>}                             <span class=\"token operator\">|</span> <span class=\"token punctuation\">[</span><span class=\"token number\">1</span><span class=\"token punctuation\">,</span> <span class=\"token number\">3</span><span class=\"token punctuation\">,</span> <span class=\"token number\">5</span><span class=\"token punctuation\">]</span> <span class=\"token operator\">|</span>\n<span class=\"token operator\">+</span><span class=\"token comment\">----+-----------------------------------------------------------+-----------+</span></code></pre></div>\n<h5 id=\"3-json_replace-只替换存在的值，不存在的则会被忽略。\"><a href=\"#3-json_replace-%E5%8F%AA%E6%9B%BF%E6%8D%A2%E5%AD%98%E5%9C%A8%E7%9A%84%E5%80%BC%EF%BC%8C%E4%B8%8D%E5%AD%98%E5%9C%A8%E7%9A%84%E5%88%99%E4%BC%9A%E8%A2%AB%E5%BF%BD%E7%95%A5%E3%80%82\" aria-label=\"3 json_replace 只替换存在的值，不存在的则会被忽略。 permalink\" class=\"anchor\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>3. <code class=\"language-text\">JSON_REPLACE()</code> 只替换存在的值，不存在的则会被忽略。</h5>\n<div class=\"gatsby-highlight\" data-language=\"sql\"><pre class=\"language-sql\"><code class=\"language-sql\"><span class=\"token keyword\">UPDATE</span> student <span class=\"token keyword\">SET</span> info <span class=\"token operator\">=</span> JSON_REPLACE<span class=\"token punctuation\">(</span>info<span class=\"token punctuation\">,</span> <span class=\"token string\">'$.name'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'Lily'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'$.class'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'three'</span><span class=\"token punctuation\">)</span> <span class=\"token keyword\">WHERE</span> id <span class=\"token operator\">=</span> <span class=\"token number\">2</span><span class=\"token punctuation\">;</span>\n\n<span class=\"token operator\">+</span><span class=\"token comment\">----+-----------------------------------------------------------+-----------+</span>\n<span class=\"token operator\">|</span> id <span class=\"token operator\">|</span> info                                                      <span class=\"token operator\">|</span> record    <span class=\"token operator\">|</span>\n<span class=\"token operator\">+</span><span class=\"token comment\">----+-----------------------------------------------------------+-----------+</span>\n<span class=\"token operator\">|</span>  <span class=\"token number\">1</span> <span class=\"token operator\">|</span> {<span class=\"token string\">\"id\"</span>: <span class=\"token number\">1</span><span class=\"token punctuation\">,</span> <span class=\"token string\">\"class\"</span>: <span class=\"token string\">\"two\"</span><span class=\"token punctuation\">,</span> <span class=\"token string\">\"age\"</span>: <span class=\"token string\">\"1\"</span><span class=\"token punctuation\">,</span> <span class=\"token string\">\"name\"</span>: <span class=\"token string\">\"xiaoming\"</span>} <span class=\"token operator\">|</span> <span class=\"token punctuation\">[</span><span class=\"token number\">1</span><span class=\"token punctuation\">,</span> <span class=\"token number\">3</span><span class=\"token punctuation\">,</span> <span class=\"token number\">4</span><span class=\"token punctuation\">]</span> <span class=\"token operator\">|</span>\n<span class=\"token operator\">|</span>  <span class=\"token number\">2</span> <span class=\"token operator\">|</span> {<span class=\"token string\">\"id\"</span>: <span class=\"token number\">2</span><span class=\"token punctuation\">,</span> <span class=\"token string\">\"name\"</span>: <span class=\"token string\">\"Lily\"</span>}                                 <span class=\"token operator\">|</span> <span class=\"token punctuation\">[</span><span class=\"token number\">1</span><span class=\"token punctuation\">,</span> <span class=\"token number\">3</span><span class=\"token punctuation\">,</span> <span class=\"token number\">5</span><span class=\"token punctuation\">]</span> <span class=\"token operator\">|</span>\n<span class=\"token operator\">+</span><span class=\"token comment\">----+-----------------------------------------------------------+-----------+</span></code></pre></div>\n<h5 id=\"4-json_remove-删除json元素\"><a href=\"#4-json_remove-%E5%88%A0%E9%99%A4json%E5%85%83%E7%B4%A0\" aria-label=\"4 json_remove 删除json元素 permalink\" class=\"anchor\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>4. <code class=\"language-text\">JSON_REMOVE()</code> 删除JSON元素</h5>\n<div class=\"gatsby-highlight\" data-language=\"sql\"><pre class=\"language-sql\"><code class=\"language-sql\"><span class=\"token keyword\">UPDATE</span> student <span class=\"token keyword\">SET</span> info <span class=\"token operator\">=</span> JSON_REMOVE<span class=\"token punctuation\">(</span>info<span class=\"token punctuation\">,</span> <span class=\"token string\">'$.class'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'$.age'</span><span class=\"token punctuation\">)</span> <span class=\"token keyword\">WHERE</span> id <span class=\"token operator\">=</span> <span class=\"token number\">1</span><span class=\"token punctuation\">;</span>\n\n<span class=\"token operator\">+</span><span class=\"token comment\">----+-------------------------------+-----------+</span>\n<span class=\"token operator\">|</span> id <span class=\"token operator\">|</span> info                          <span class=\"token operator\">|</span> record    <span class=\"token operator\">|</span>\n<span class=\"token operator\">+</span><span class=\"token comment\">----+-------------------------------+-----------+</span>\n<span class=\"token operator\">|</span>  <span class=\"token number\">1</span> <span class=\"token operator\">|</span> {<span class=\"token string\">\"id\"</span>: <span class=\"token number\">1</span><span class=\"token punctuation\">,</span> <span class=\"token string\">\"name\"</span>: <span class=\"token string\">\"xiaoming\"</span>} <span class=\"token operator\">|</span> <span class=\"token punctuation\">[</span><span class=\"token number\">1</span><span class=\"token punctuation\">,</span> <span class=\"token number\">3</span><span class=\"token punctuation\">,</span> <span class=\"token number\">4</span><span class=\"token punctuation\">]</span> <span class=\"token operator\">|</span>\n<span class=\"token operator\">|</span>  <span class=\"token number\">2</span> <span class=\"token operator\">|</span> {<span class=\"token string\">\"id\"</span>: <span class=\"token number\">2</span><span class=\"token punctuation\">,</span> <span class=\"token string\">\"name\"</span>: <span class=\"token string\">\"Lily\"</span>}     <span class=\"token operator\">|</span> <span class=\"token punctuation\">[</span><span class=\"token number\">1</span><span class=\"token punctuation\">,</span> <span class=\"token number\">3</span><span class=\"token punctuation\">,</span> <span class=\"token number\">5</span><span class=\"token punctuation\">]</span> <span class=\"token operator\">|</span>\n<span class=\"token operator\">+</span><span class=\"token comment\">----+-------------------------------+-----------+</span></code></pre></div>\n<h4 id=\"在sequelize下进行更新操作\"><a href=\"#%E5%9C%A8sequelize%E4%B8%8B%E8%BF%9B%E8%A1%8C%E6%9B%B4%E6%96%B0%E6%93%8D%E4%BD%9C\" aria-label=\"在sequelize下进行更新操作 permalink\" class=\"anchor\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>在Sequelize下进行更新操作</h4>\n<div class=\"gatsby-highlight\" data-language=\"javascript\"><pre class=\"language-javascript\"><code class=\"language-javascript\">student<span class=\"token punctuation\">.</span><span class=\"token function\">update</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">{</span>\n  info<span class=\"token punctuation\">:</span>Sequelize<span class=\"token punctuation\">.</span><span class=\"token function\">fn</span><span class=\"token punctuation\">(</span><span class=\"token string\">'上述三种方法'</span><span class=\"token punctuation\">,</span> Sequelize<span class=\"token punctuation\">.</span><span class=\"token function\">col</span><span class=\"token punctuation\">(</span><span class=\"token string\">'info'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'$.name'</span><span class=\"token punctuation\">,</span><span class=\"token string\">'Lucy'</span><span class=\"token punctuation\">)</span>\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></code></pre></div>","tableOfContents":"<ul>\n<li><a href=\"/blog/notebook/database/mysql_json/#%E5%88%9B%E5%BB%BA\">创建</a></li>\n<li><a href=\"/blog/notebook/database/mysql_json/#%E6%8F%92%E5%85%A5\">插入</a></li>\n<li>\n<p><a href=\"/blog/notebook/database/mysql_json/#%E6%9F%A5%E8%AF%A2\">查询</a></p>\n<ul>\n<li><a href=\"/blog/notebook/database/mysql_json/#%E6%9F%A5%E8%AF%A2%E5%AD%97%E6%AE%B5\">查询字段</a></li>\n<li><a href=\"/blog/notebook/database/mysql_json/#%E6%9D%A1%E4%BB%B6%E6%90%9C%E7%B4%A2\">条件搜索</a></li>\n</ul>\n</li>\n<li>\n<p><a href=\"/blog/notebook/database/mysql_json/#%E6%9B%B4%E6%96%B0\">更新</a></p>\n<ul>\n<li><a href=\"/blog/notebook/database/mysql_json/#1-json_insert-%E6%8F%92%E5%85%A5%E6%96%B0%E5%80%BC%EF%BC%8C%E4%BD%86%E4%B8%8D%E4%BC%9A%E8%A6%86%E7%9B%96%E5%B7%B2%E5%AD%98%E5%9C%A8%E7%9A%84%E5%80%BC%E3%80%82\">1. &#x3C;code class=\"language-text\">JSON_INSERT()&#x3C;/code> 插入新值，但不会覆盖已存在的值。</a></li>\n<li><a href=\"/blog/notebook/database/mysql_json/#2-json_set-%E6%8F%92%E5%85%A5%E6%96%B0%E5%80%BC%EF%BC%8C%E5%B9%B6%E8%A6%86%E7%9B%96%E5%B7%B2%E5%AD%98%E5%9C%A8%E7%9A%84%E5%80%BC%E3%80%82\">2. &#x3C;code class=\"language-text\">JSON_SET()&#x3C;/code> 插入新值，并覆盖已存在的值。</a></li>\n<li><a href=\"/blog/notebook/database/mysql_json/#3-json_replace-%E5%8F%AA%E6%9B%BF%E6%8D%A2%E5%AD%98%E5%9C%A8%E7%9A%84%E5%80%BC%EF%BC%8C%E4%B8%8D%E5%AD%98%E5%9C%A8%E7%9A%84%E5%88%99%E4%BC%9A%E8%A2%AB%E5%BF%BD%E7%95%A5%E3%80%82\">3. &#x3C;code class=\"language-text\">JSON_REPLACE()&#x3C;/code> 只替换存在的值，不存在的则会被忽略。</a></li>\n<li><a href=\"/blog/notebook/database/mysql_json/#4-json_remove-%E5%88%A0%E9%99%A4json%E5%85%83%E7%B4%A0\">4. &#x3C;code class=\"language-text\">JSON_REMOVE()&#x3C;/code> 删除JSON元素</a></li>\n</ul>\n</li>\n<li><a href=\"/blog/notebook/database/mysql_json/#%E5%9C%A8sequelize%E4%B8%8B%E8%BF%9B%E8%A1%8C%E6%9B%B4%E6%96%B0%E6%93%8D%E4%BD%9C\">在Sequelize下进行更新操作</a></li>\n</ul>","frontmatter":{"title":"MySQL 之 JSON数据类型及其在Sequelize下的使用","date":"2019-12-19 03:55","description":"MySQL 5.7添加的新特性 JSON，可以直接在数据库中对JSON对象进行操作","type":"数据库"}}},"pageContext":{"isCreatedByStatefulCreatePages":false,"slug":"/notebook/database/mysql_json/","previous":{"fields":{"slug":"/notebook/front_end/scss/"},"frontmatter":{"title":"scss学习"}},"next":null}}}