{"componentChunkName":"component---src-templates-blog-post-js","path":"/notebook/gtm/overview/","result":{"data":{"markdownRemark":{"html":"<p><code class=\"language-text\">Google Tag Manger</code> 用于减轻埋点负担，将大部分工作从网页编码中移出，当它和<code class=\"language-text\">Google Analytics</code>结合使用时，相当于插入了谷歌分析和网页代码之间，所以不再需要在网页中使用<code class=\"language-text\">gtag.js</code>等。</p>\n<h5># 容器</h5>\n<ul>\n<li>包含一个项目，拥有一个容器码，用于嵌入网页。</li>\n<li>\n<p>嵌入代码有两段，在<code class=\"language-text\">管理 → 安装Google跟踪代码管理器</code> 中可以找到 </p>\n<ul>\n<li>第一段嵌入<code class=\"language-text\">&lt;head&gt;</code>中，尽量靠顶 </li>\n<li>\n<div class=\"gatsby-highlight\" data-language=\"javascript\"><pre class=\"language-javascript\"><code class=\"language-javascript\"><span class=\"token punctuation\">(</span><span class=\"token keyword\">function</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">w<span class=\"token punctuation\">,</span>d<span class=\"token punctuation\">,</span>s<span class=\"token punctuation\">,</span>l<span class=\"token punctuation\">,</span>i</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">{</span>\n  w<span class=\"token punctuation\">[</span>l<span class=\"token punctuation\">]</span><span class=\"token operator\">=</span>w<span class=\"token punctuation\">[</span>l<span class=\"token punctuation\">]</span><span class=\"token operator\">||</span><span class=\"token punctuation\">[</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">;</span>\n  w<span class=\"token punctuation\">[</span>l<span class=\"token punctuation\">]</span><span class=\"token punctuation\">.</span><span class=\"token function\">push</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">{</span>\n    <span class=\"token string\">'gtm.start'</span><span class=\"token punctuation\">:</span><span class=\"token operator\">&lt;</span>span <span class=\"token keyword\">class</span><span class=\"token operator\">=</span><span class=\"token string\">\"ag-soft-line-break\"</span><span class=\"token operator\">></span><span class=\"token operator\">&lt;</span><span class=\"token operator\">/</span>span<span class=\"token operator\">></span><span class=\"token keyword\">new</span> <span class=\"token class-name\">Date</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">getTime</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span>\n    event<span class=\"token punctuation\">:</span><span class=\"token string\">'gtm.js'</span>\n  <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n  <span class=\"token keyword\">var</span> f<span class=\"token operator\">=</span>d<span class=\"token punctuation\">.</span><span class=\"token function\">getElementsByTagName</span><span class=\"token punctuation\">(</span>s<span class=\"token punctuation\">)</span><span class=\"token punctuation\">[</span><span class=\"token number\">0</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">,</span>\n  <span class=\"token operator\">&lt;</span>span <span class=\"token keyword\">class</span><span class=\"token operator\">=</span><span class=\"token string\">\"ag-soft-line-break\"</span><span class=\"token operator\">></span><span class=\"token operator\">&lt;</span><span class=\"token operator\">/</span>span<span class=\"token operator\">></span>j<span class=\"token operator\">=</span>d<span class=\"token punctuation\">.</span><span class=\"token function\">createElement</span><span class=\"token punctuation\">(</span>s<span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span>\n  dl<span class=\"token operator\">=</span>l<span class=\"token operator\">!=</span><span class=\"token string\">'dataLayer'</span><span class=\"token operator\">?</span><span class=\"token string\">'&amp;l='</span><span class=\"token operator\">+</span>l<span class=\"token punctuation\">:</span><span class=\"token string\">''</span><span class=\"token punctuation\">;</span>\n  j<span class=\"token punctuation\">.</span>async<span class=\"token operator\">=</span><span class=\"token boolean\">true</span><span class=\"token punctuation\">;</span>\n  j<span class=\"token punctuation\">.</span>src<span class=\"token operator\">=</span><span class=\"token operator\">&lt;</span>span <span class=\"token keyword\">class</span><span class=\"token operator\">=</span><span class=\"token string\">\"ag-soft-line-break\"</span><span class=\"token operator\">></span><span class=\"token operator\">&lt;</span><span class=\"token operator\">/</span>span<span class=\"token operator\">></span><span class=\"token string\">'https://www.googletagmanager.com/gtm.js?id='</span><span class=\"token operator\">+</span>i<span class=\"token operator\">+</span>dl<span class=\"token punctuation\">;</span>f<span class=\"token punctuation\">.</span>parentNode<span class=\"token punctuation\">.</span><span class=\"token function\">insertBefore</span><span class=\"token punctuation\">(</span>j<span class=\"token punctuation\">,</span>f<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n  <span class=\"token operator\">&lt;</span>span <span class=\"token keyword\">class</span><span class=\"token operator\">=</span><span class=\"token string\">\"ag-soft-line-break\"</span><span class=\"token operator\">></span><span class=\"token operator\">&lt;</span><span class=\"token operator\">/</span>span<span class=\"token operator\">></span>\n  <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">(</span>window<span class=\"token punctuation\">,</span>document<span class=\"token punctuation\">,</span><span class=\"token string\">'script'</span><span class=\"token punctuation\">,</span><span class=\"token string\">'dataLayer'</span><span class=\"token punctuation\">,</span><span class=\"token string\">'GTM-MGJBX6K'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></code></pre></div>\n</li>\n<li>第二段代码紧跟起始<code class=\"language-text\">&lt;body&gt;</code>，是预览时弹出的调试窗口</li>\n<li>\n<div class=\"gatsby-highlight\" data-language=\"javascript\"><pre class=\"language-javascript\"><code class=\"language-javascript\"><span class=\"token operator\">&lt;</span><span class=\"token operator\">!</span><span class=\"token operator\">--</span> Google Tag <span class=\"token function\">Manager</span> <span class=\"token punctuation\">(</span>noscript<span class=\"token punctuation\">)</span> <span class=\"token operator\">--</span><span class=\"token operator\">></span>\n<span class=\"token operator\">&lt;</span>noscript<span class=\"token operator\">></span>\n  <span class=\"token operator\">&lt;</span>iframe src<span class=\"token operator\">=</span><span class=\"token string\">\"https://www.googletagmanager.com/ns.html?id=GTM-MGJBX6K\"</span> height<span class=\"token operator\">=</span><span class=\"token string\">\"0\"</span> width<span class=\"token operator\">=</span><span class=\"token string\">\"0\"</span> style<span class=\"token operator\">=</span><span class=\"token string\">\"display:none;visibility:hidden\"</span><span class=\"token operator\">></span>\n  <span class=\"token operator\">&lt;</span><span class=\"token operator\">/</span>iframe<span class=\"token operator\">></span>\n<span class=\"token operator\">&lt;</span><span class=\"token operator\">/</span>noscript<span class=\"token operator\">></span>\n<span class=\"token operator\">&lt;</span><span class=\"token operator\">!</span><span class=\"token operator\">--</span> End Google Tag <span class=\"token function\">Manager</span> <span class=\"token punctuation\">(</span>noscript<span class=\"token punctuation\">)</span> <span class=\"token operator\">--</span><span class=\"token operator\">></span></code></pre></div>\n</li>\n</ul>\n</li>\n</ul>\n<h5># 变量 (variable)</h5>\n<p>主要分为<code class=\"language-text\">内置变量</code>和<code class=\"language-text\">用户定义的变量</code></p>\n<p>内置变量需要勾选生效，没有使用的默认不开启：</p>\n<ul>\n<li>\n<p><strong>网页</strong></p>\n<ul>\n<li><code class=\"language-text\">Page URL</code></li>\n<li><code class=\"language-text\">Page Hostname</code></li>\n<li><code class=\"language-text\">Page Path</code></li>\n<li><code class=\"language-text\">Referrer</code></li>\n</ul>\n</li>\n<li>\n<p><strong>实用工具</strong></p>\n<ul>\n<li><code class=\"language-text\">Event</code></li>\n<li><code class=\"language-text\">Environment Name</code></li>\n<li><code class=\"language-text\">Container Version</code></li>\n<li><code class=\"language-text\">Random Number</code></li>\n<li><code class=\"language-text\">HTML ID</code></li>\n</ul>\n</li>\n<li>\n<p><strong>错误</strong></p>\n<ul>\n<li><code class=\"language-text\">Error Message</code></li>\n<li><code class=\"language-text\">Error URL</code></li>\n<li><code class=\"language-text\">Error Line</code></li>\n<li><code class=\"language-text\">Debug Mode</code></li>\n</ul>\n</li>\n<li>\n<p><strong>点击</strong></p>\n<ul>\n<li><code class=\"language-text\">Click Element</code>：点击的DOM元素对象</li>\n<li><code class=\"language-text\">Click Classes</code></li>\n<li><code class=\"language-text\">Click ID</code></li>\n<li><code class=\"language-text\">Click Target</code></li>\n<li><code class=\"language-text\">Click URL</code></li>\n<li><code class=\"language-text\">Click Text</code></li>\n</ul>\n</li>\n<li>\n<p><strong>表单</strong></p>\n<ul>\n<li><code class=\"language-text\">Form Element</code></li>\n<li><code class=\"language-text\">Form Classes</code></li>\n<li><code class=\"language-text\">Form ID</code></li>\n<li><code class=\"language-text\">Form Target</code></li>\n<li><code class=\"language-text\">Form URL</code></li>\n<li><code class=\"language-text\">Form Text</code> </li>\n</ul>\n</li>\n<li>\n<p><strong>历史记录</strong></p>\n<ul>\n<li><code class=\"language-text\">New History Fragment</code></li>\n<li><code class=\"language-text\">Old History Fragement</code></li>\n<li><code class=\"language-text\">New History State</code></li>\n<li><code class=\"language-text\">Old History State</code></li>\n<li><code class=\"language-text\">History Source</code></li>\n</ul>\n</li>\n<li>\n<p><strong>视频</strong></p>\n<ul>\n<li><code class=\"language-text\">Video Provider</code></li>\n<li><code class=\"language-text\">Video Status</code></li>\n<li><code class=\"language-text\">Video URL</code></li>\n<li><code class=\"language-text\">Video Title</code></li>\n<li><code class=\"language-text\">Video Duration</code></li>\n<li><code class=\"language-text\">Video Current Time</code></li>\n<li><code class=\"language-text\">Video Percent</code></li>\n<li><code class=\"language-text\">Video Visible</code></li>\n</ul>\n</li>\n<li>\n<p><strong>滚动</strong></p>\n<ul>\n<li><code class=\"language-text\">Scroll Depth Threshold</code></li>\n<li><code class=\"language-text\">Scroll Depth Units</code></li>\n<li><code class=\"language-text\">Scroll Direction</code></li>\n</ul>\n</li>\n<li>\n<p><strong>公开范围</strong></p>\n<ul>\n<li><code class=\"language-text\">Percent Visible</code></li>\n<li><code class=\"language-text\">On-Screen Duration</code></li>\n</ul>\n</li>\n</ul>\n<p>自定义变量：</p>\n<ul>\n<li>\n<p><strong>导航</strong></p>\n<ul>\n<li><code class=\"language-text\">网址</code></li>\n<li><code class=\"language-text\">Http引荐来源网址</code></li>\n</ul>\n</li>\n<li>\n<p><strong>网页变量</strong></p>\n<ul>\n<li><code class=\"language-text\">第一方Cookie</code>：返回浏览器cookie中该变量的值</li>\n<li><code class=\"language-text\">数据层变量</code>：通过dataLayer.push传递的键值对</li>\n<li><code class=\"language-text\">未定义的值</code></li>\n<li><code class=\"language-text\">自定义javascript</code>：自己写的js函数的返回值，其中可以用<code class=\"language-text\">{{}}</code>来使用已存在的变量</li>\n<li><code class=\"language-text\">javascript变量</code>：抓取页面的全局变量</li>\n</ul>\n</li>\n<li>\n<p><strong>页面元素</strong></p>\n<ul>\n<li><code class=\"language-text\">元素可见性</code></li>\n<li><code class=\"language-text\">自动事件变量</code></li>\n<li><code class=\"language-text\">DOM元素</code></li>\n</ul>\n</li>\n<li>\n<p><strong>实用工具</strong></p>\n<ul>\n<li><code class=\"language-text\">常量</code></li>\n<li><code class=\"language-text\">对照表</code>：根据输入值的不同，然后返回对应的输出值，类似switch</li>\n<li><code class=\"language-text\">环境名称</code></li>\n<li><code class=\"language-text\">随机数字</code>：0~2147483647的随机数 (含边界)</li>\n<li><code class=\"language-text\">正则表达式表格</code>：输入值用正则来匹配的对照表</li>\n<li><code class=\"language-text\">自定义事件</code></li>\n<li><code class=\"language-text\">Google Analytics(分析) 设置</code></li>\n</ul>\n</li>\n<li>\n<p><strong>容器数据</strong></p>\n<ul>\n<li><code class=\"language-text\">调试模式</code>：当处于调试模式时，该值为true</li>\n<li><code class=\"language-text\">容器ID</code></li>\n<li><code class=\"language-text\">容器版本号</code></li>\n</ul>\n</li>\n</ul>\n<h5># 触发器</h5>\n<p>制定规则，即规定好触发代码的条件</p>\n<p>触发器类型：</p>\n<ul>\n<li>\n<p>网页浏览</p>\n<ul>\n<li><code class=\"language-text\">DOM已准备就绪</code></li>\n<li><code class=\"language-text\">窗口已加载</code></li>\n<li><code class=\"language-text\">网页浏览</code></li>\n</ul>\n</li>\n<li>\n<p>点击</p>\n<ul>\n<li><code class=\"language-text\">仅链接</code></li>\n<li><code class=\"language-text\">所有元素</code></li>\n</ul>\n</li>\n<li>\n<p>用户深度互动情况</p>\n<ul>\n<li><code class=\"language-text\">YouTube视频</code></li>\n<li><code class=\"language-text\">元素可见性</code></li>\n<li><code class=\"language-text\">滚动深度</code></li>\n<li><code class=\"language-text\">表单提交</code>：<code class=\"language-text\">form</code>提交成功的跟踪，需要<code class=\"language-text\">form</code>最后的提交按钮类型是submit才能触发。</li>\n</ul>\n</li>\n<li>\n<p>其他</p>\n<ul>\n<li><code class=\"language-text\">JavaScript错误</code></li>\n<li><code class=\"language-text\">历史记录更改</code>：网址的变化跟踪，可用于单页应用的网页浏览跟踪。</li>\n<li><code class=\"language-text\">定时器</code></li>\n<li><code class=\"language-text\">自定义事件</code>：通过<code class=\"language-text\">dataLayer.push({event:事件})</code>触发，跟踪不便通过前端变化定位的事件。</li>\n<li><code class=\"language-text\">触发器组</code></li>\n</ul>\n</li>\n</ul>\n<h5># 代码</h5>\n<ul>\n<li>\n<p>设定类型和触发器，即满足触发条件之后，向某个统计工具发送指定的消息。</p>\n<ol>\n<li>Universal Analytics：向特定的GA view发送数据</li>\n<li>自定义html：向页面插入代码，可用于事件监控，再营销代码部署，GA基础代码部署</li>\n</ol>\n</li>\n</ul>\n<h5># GTM debug</h5>\n<ul>\n<li>线上预览</li>\n<li>demo站点</li>\n</ul>","frontmatter":{"title":"GTM 概述","date":"2019-09-20T05:44:04.284Z","description":"Google Tag Manager基础入门","type":"Google Tag Manager"}}},"pageContext":{"isCreatedByStatefulCreatePages":false,"slug":"/notebook/gtm/overview/","previous":{"fields":{"slug":"/notebook/gatsby/learn/"},"frontmatter":{"title":"Gatsby学习笔记"}},"next":{"fields":{"slug":"/notebook/gtm/form-track/"},"frontmatter":{"title":"GTM 表单追踪"}}}}}